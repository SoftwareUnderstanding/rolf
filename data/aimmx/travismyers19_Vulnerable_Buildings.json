{
    "visibility": {
        "visibility": "public",
        "license": "MIT License"
    },
    "name": "Vulnerable Building Detection",
    "definition": {
        "code": [
            {
                "type": "repo",
                "repo_type": "github",
                "owner": "travismyers19",
                "owner_type": "User",
                "name": "Vulnerable_Buildings",
                "url": "https://github.com/travismyers19/Vulnerable_Buildings",
                "stars": 1,
                "pushed_at": "2022-03-12 00:16:02+00:00",
                "created_at": "2020-01-16 18:14:23+00:00",
                "language": "Python",
                "description": "Machine Learning Project for the Insight Fellows Program to classify soft story buildings that are vulnerable to earthquakes.",
                "license": "MIT License",
                "frameworks": [
                    "TensorFlow"
                ]
            },
            {
                "type": "code",
                "name": ".DS_Store",
                "sha": "5008ddfcf53c02e82d7eee2e57c38e5672ef89f6",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/.DS_Store"
                    }
                },
                "size": 6148
            },
            {
                "type": "code",
                "name": ".gitignore",
                "sha": "8f35bd342c3775e4820df194acae5bd0608ffbcc",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/.gitignore"
                    }
                },
                "size": 1836
            },
            {
                "type": "code",
                "name": "Addresses",
                "sha": "e57e672311619514588a0e186f3a8d5b93527827",
                "filetype": "dir",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/tree/master/Addresses"
                    }
                },
                "num_files": 2
            },
            {
                "type": "code",
                "name": "Configs",
                "sha": "5db6fb0cbba746dd70c0607a8fb1f0c2d5f6fdd3",
                "filetype": "dir",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/tree/master/Configs"
                    }
                },
                "num_files": 1
            },
            {
                "type": "code",
                "name": "LICENSE",
                "sha": "81c9007146f0a8134b0a7e61281cc98d108c1bae",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/LICENSE"
                    }
                },
                "size": 1074
            },
            {
                "type": "code",
                "name": "Models",
                "sha": "d1883b4b961c10744e7539a1c11dbc1e12e12b61",
                "filetype": "dir",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/tree/master/Models"
                    }
                },
                "num_files": 1
            },
            {
                "type": "code",
                "name": "Modules",
                "sha": "ec8c87a309e16da5fb3344a9e54f2417bb83f546",
                "filetype": "dir",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/tree/master/Modules"
                    }
                },
                "num_files": 4
            },
            {
                "type": "code",
                "name": "Small_Data",
                "sha": "0fdf4223db6084a1d48d617ad135e270cf9db430",
                "filetype": "dir",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/tree/master/Small_Data"
                    }
                },
                "num_files": 3
            },
            {
                "type": "code",
                "name": "api-key.txt",
                "sha": "8b5083c1a838c3a86d74613f81143364ddf3dc4c",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/api-key.txt"
                    }
                },
                "size": 24
            },
            {
                "type": "code",
                "name": "create_inception_model.py",
                "sha": "e033f3e50cf3f2f05f045d1595f2f37b409c6f9c",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/create_inception_model.py"
                    }
                },
                "size": 1748
            },
            {
                "type": "code",
                "name": "get_non_soft_story_images.py",
                "sha": "bfd24e6654eec676053f021b57cc0e8b66578315",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/get_non_soft_story_images.py"
                    }
                },
                "size": 4132
            },
            {
                "type": "code",
                "name": "get_random_addresses.py",
                "sha": "7c6ffc2b7222d35e01e336809cb1ecba5237df6c",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/get_random_addresses.py"
                    }
                },
                "size": 1401
            },
            {
                "type": "code",
                "name": "get_soft_story_images.py",
                "sha": "5730159c0fd51cf8d1274bb6a3a0492283a2c1f3",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/get_soft_story_images.py"
                    }
                },
                "size": 2357
            },
            {
                "type": "code",
                "name": "plot_metrics.py",
                "sha": "a5153ab55162f47cbe83ff3b4fc1c545430c4d2f",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/plot_metrics.py"
                    }
                },
                "size": 998
            },
            {
                "type": "code",
                "name": "product.py",
                "sha": "7f8e2cbb89ec90dc5b4d3718c35ddff5a6470add",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/product.py"
                    }
                },
                "size": 4505
            },
            {
                "type": "code",
                "name": "requirements.txt",
                "sha": "be596e2bfbdba10e256110ebd2495b8016dc4bff",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/requirements.txt"
                    }
                },
                "size": 4233
            },
            {
                "type": "code",
                "name": "train.sh",
                "sha": "ea8ee43814f85a9c4d1485dc5764eff070e6724c",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/train.sh"
                    }
                },
                "size": 1469
            },
            {
                "type": "code",
                "name": "train_inception_model.py",
                "sha": "4606ec62331efa1e918794acea5b3a2bdadf8453",
                "filetype": "file",
                "connection": {
                    "name": "github_url",
                    "source": {
                        "url": "https://github.com/travismyers19/Vulnerable_Buildings/blob/master/train_inception_model.py"
                    }
                },
                "size": 782
            }
        ]
    },
    "authors": [
        {
            "name": "travismyers19",
            "github_id": "travismyers19"
        },
        {
            "name": "AntonMu",
            "email": "antonmuehlemann@gmail.com",
            "github_id": "AntonMu"
        }
    ],
    "tags": [],
    "description": "Machine Learning Project for the Insight Fellows Program to classify soft story buildings that are vulnerable to earthquakes.",
    "extraction": [
        {
            "type": "github",
            "url": "https://github.com/travismyers19/Vulnerable_Buildings",
            "stars": 1,
            "issues": true,
            "readme": "# Vulnerable Building Detection\nA soft-story building is a multiple-story building in which the first floor is \"soft\", meaning it consists mostly of garage door openings or windows or other openings.  Soft-story buildings are particularly vulnerable to earthquakes, and thus the ability to quickly inventory soft-story buildings in an area may be of use to city or state officials.  This repo contains code to leverage transfer learning to create and train a custom Inception V3 image classifier to detect soft-story buildings and deploy the model in a user-friendly Streamlit app.\n\n## Overview\nThe Streamlit app takes as input from the user latitude and longitude coordinates specifying a bounding box region of the world and also a number of addresses.  The app generates random latitude and longitude locations within that bounding box and uses reverse geocoding to obtain addresses.  Then it uses those addresses to obtain Google Street View images.  The images are then sent through the trained image classifier, the bad images are discarded, and the results are presented to the user: \"Soft-Story\" means that the image is of a soft-story building and \"Non-Soft-Story\" means that the image is of a non-soft-story buildng.\n\nThere are two types of models that can be used:\n\n- Ternary classification:  A single model classifies the images into the three categories:  \"Soft\", \"Non-Soft\", and \"Bad Image\" (a bad image is one in which there is no building in the image or the building is obscured or it's unclear which building the image is an image of).\n\n- Binary classification:  One model classifies the image as good or bad, and then a second model classifies the image as soft or non-soft.\n\n## Installation\nClone the Github repo:\n\n```\ngit clone https://github.com/travismyers19/Vulnerable_Buildings\n```\n\nChange current directory to the project directory:\n\n```\ncd Vulnerable_Buildings\n```\n\nAll command line commands below assume that the user is in the project directory unless otherwise specified.\n\n## Initial Setup\n\n### If using the Ubuntu Deep Learning AMI:\n\nActivate the tensorflow 2.0 with Python 3.6 environment:\n\n```\nsource activate tensorflow2_p36\n```\n\nInstall Streamlit:\n\n```\npip install streamlit\n```\n\n### If not using the Ubuntu Deep Learning AMI, but using conda:\nCreate a conda environment from \"configs/environment.yml:\n\n```\nconda env create -f Configs/environment.yml\n```\n\nActivate the conda environment:\n\n```\nsource activate tensorflow2_p36\n```\n\n### If using neither conda nor the Ubuntu Deep Learning AMI:\nInstall from `requirements.txt`:\n\n```\npip install -r requirements.txt\n```\n\n## Modules\nThe `Modules` folder contains all of the custom modules in this repo.\n\n### `addresses.py`\nThis module contains the class Addresses which provides functionality for grabbing random addresses using reverse geocoding and for getting images from Google Street View corresponding to given addresses.\n\n### `buildingclassifier.py`\nThis module contains the class BuildingClassifier which provides functionality for creating and training custom Inception V3 models for either ternary classification or binary classification, as well as functions for evaluating a model to determine the following statistics given a directory containing test images:\n\n- Accuracy:  Percentage of the test images labeled correctly.\n- Soft Precision:  Precision in determining soft vs. non-soft.\n- Soft Recall:  Recall in determining soft vs. non-soft.\n- Good Precision:  Precision in determining good image vs. bad image.\n- Good Recall:  Recall in determining good image vs. bad image.\n\n### `customlosses.py`\nThis module contains custom loss functions for binary crossentropy and categorical cross entropy which incorporate the focal loss modification described in this paper:  https://arxiv.org/abs/1708.02002\n\n### `imagefunctions.py`\nThis module contains functions for saving a single image and for loading a single image into a numpy array that can be fed to the model for prediction.\n\n## Collecting Data\nThe folder `Small_Data` contains a small amount of data that can be used.  The following scripts provide functionality for collecting more data and, by default, saving it in the `Data` folder.  Each of these scripts requires a Google API Key.  By default, it is assumed that the api key is located in the project directory in a text file called `api_key.txt`.\n\n### `get_random_addressees.py`\nGets random addresses from a region specified by latitude and longitude coordinates and writes them to a csv file.  A file with 100 such random addresses is provided in `Addresses/random_addresses.csv`.\n\nType `python get_random_addresses.py -h` in the command line to view the list of arguments that can be passed to this script.\n\n### `get_soft_story_images.py`\nGets Google Street View images given a csv file of addresses and saves them to the `Data` folder by default.  A list of soft-story addresses provided by the city of San Francisco is located at `Addresses/Soft-Story-Properties.csv`.\n\nType `python get_soft_story_images.py -h` in the command line to view the list of arguments that can be passed to this script.\n\n### `get_non_soft_story_images.py`\nGiven a csv file of addresses, displays the Google Street View image of each one for the user to manually label as \"non-soft-story\" (press \"y' when the image appears) or \"bad image\" (press \"u\" when the image appears).  By default it saves the manually labeled images to the `Data` folder.\n\nType `python get_non_soft_story_images.py -h` in the command line to view the list of arguments that can be passed to this script.\n\n## Creating a Custom Inception Model Using Transfer Learning\nRun `create_inception_model.py` in the command line to create and save a custom Inception V3 model:\n\n```\npython create_inception_model.py\n```\n\nType `python create_inception_model.py -h` in the command line to view the arguments that can be passed to the script:\n```\n  --model_filename MODEL_FILENAME\n                        The location to save the created model. Default is\n                        'Models/model.h5'.\n  --number_categories NUMBER_CATEGORIES\n                        The number of output categories for the model (3 =\n                        ternary classifier, 1 = binary classifier). Default is\n                        3.\n  --dense_layer_sizes DENSE_LAYER_SIZES\n                        A list of the sizes of the dense layers to be added\n                        onto the pretrained model. Default is '[1024, 512,\n                        256]'.\n  --dropout_fraction DROPOUT_FRACTION\n                        The dropout fraction to be used after each dense\n                        layer. Default is 0.2\n  --unfrozen_layers UNFROZEN_LAYERS\n                        The number of layers to unfreeze for training. Default\n                        is 21.\n  --focal_loss FOCAL_LOSS\n                        Modify loss function to use focal loss. Default is\n                        False.\n```\n## Training the Model\nRun `train.sh` to train a model:\n\n```\n./train.sh\n```\n\nThe training is run using a bash script in order to utilize the Horovod package which allows for distributed computing.\nSet the following variables within the `train.sh` bash script:\n\n- `HOSTS`:  if you want to use distributed computing, list all hosts that will be used.  If only one host is listed, it doesn't matter what that host is because only the localhost will be used.\n- `GPUS`:  the number of GPUs on each host.  Default: `1`.\n- `TRAINING_DIRECTORY`:  the directory where the training images are located.  If using binary classification, there should be two subfolders in this directory; if using ternary classification, there should be three subfolders.  Default: `Small_Data`.\n- `TEST_DIRECTORY`:  the directory where the test images are located (for the purpose of calculating loss and accuracy).  Default: `Small_Data`.\n- `MODEL_FILENAME`:  the location of the model to be trained.  Default:  `Models/model.h5`.\n- `TRAINED_MODEL_FILENAME`:  the location to save the trained model.  Default:  `Models/trained_model.h5`.\n- `METRICS_FILENAME`:  the location to save the loss and accuracy.  It will be saved as a numpy array where the first row is the accuracy in each epoch and the second row is the loss in each epoch.  Default:  `metrics.npy`.\n- `WEIGHTS`:  the weights to apply to each class to combat class imbalance.  Default:  `\"None\"`.\n- `BINARY`:  set to 0 if ternary classification, set to 1 if binary classification.  Default: `0`.\n- `EPOCHS`:  the number of epochs to train.  Default:  `5`.\n\n## Plotting Training Metrics Using Streamlit\nRun `plot_metrics.py` in the command line:\n\n```\nstreamlit run plot_metrics.py\n```\n\nTo specify the location of the metrics file, use the argument `--metrics_filename`:\n\n```\nstreamlit run plot_metrics.py -- --metrics_filename \"Models/metrics.npy\"\n```\n\n## Launching the Streamlit App\nRun `product.py` in the command line:\n\n```\nstreamlit run product.py\n```\n\nThis will output an external http address that any browser can view.\nType `python product.py -h` n the command line to view the arguments to pass to the script:\n\n```\n  --api_key_filename API_KEY_FILENAME\n                        The file location of a text file containing a Google\n                        API Key. Default is 'api-key.txt'.\n  --model_filename MODEL_FILENAME\n                        The file location of the model to serve. Default is\n                        'Models/trained_test_model.h5'.\n  --model2_filename MODEL2_FILENAME\n                        If using a binary classifier, specify the file\n                        location of the second model. If using a ternary\n                        classifier, set to 'None'. Default is 'None'.\n```\n\nFor instance, to specify the `api_key_filename` argument:\n\n```\nstreamlit run product.py -- --api_key_filename \"api-key.txt\"\n```",
            "readme_url": "https://github.com/travismyers19/Vulnerable_Buildings",
            "frameworks": [
                "TensorFlow"
            ]
        }
    ],
    "references": [
        {
            "title": "Focal Loss for Dense Object Detection",
            "arxiv": "1708.02002",
            "year": 2017,
            "url": "http://arxiv.org/abs/1708.02002v2",
            "abstract": "The highest accuracy object detectors to date are based on a two-stage\napproach popularized by R-CNN, where a classifier is applied to a sparse set of\ncandidate object locations. In contrast, one-stage detectors that are applied\nover a regular, dense sampling of possible object locations have the potential\nto be faster and simpler, but have trailed the accuracy of two-stage detectors\nthus far. In this paper, we investigate why this is the case. We discover that\nthe extreme foreground-background class imbalance encountered during training\nof dense detectors is the central cause. We propose to address this class\nimbalance by reshaping the standard cross entropy loss such that it\ndown-weights the loss assigned to well-classified examples. Our novel Focal\nLoss focuses training on a sparse set of hard examples and prevents the vast\nnumber of easy negatives from overwhelming the detector during training. To\nevaluate the effectiveness of our loss, we design and train a simple dense\ndetector we call RetinaNet. Our results show that when trained with the focal\nloss, RetinaNet is able to match the speed of previous one-stage detectors\nwhile surpassing the accuracy of all existing state-of-the-art two-stage\ndetectors. Code is at: https://github.com/facebookresearch/Detectron.",
            "authors": [
                "Tsung-Yi Lin",
                "Priya Goyal",
                "Ross Girshick",
                "Kaiming He",
                "Piotr Doll\u00e1r"
            ]
        }
    ],
    "domain": {
        "domain_type": "Computer Vision",
        "domain_prob": 0.8879463061888104,
        "task": "Object Detection",
        "task_prob": 0.9184434867783076
    }
}